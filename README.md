
mule-deploy-project

# Context

This Maven project can be used as standalone independent deployment project to deploy any Mule Deplayble Archives (MDA) aimming at different deployment targets, which includes

  Mule Runtime Manager Related

    1. Anypoint Runtime Manager (Mule Runtime relate
    2. Cloudhub
    3. MMC
  
  API Manager related
  
    1. API Manager (post Anypoint Platform Crowd release)
  
Different Maven profile can be use for the respective deployment target. For instance, to deploy a MDA to ARM, the maven command will
be  "mvn deploy -P arm -Dargs=...". The following section will detail the arguments which can be used in each profile.

## API Manager related deployment

### create API instance in API Manager 

The maven profile "crowd" is used to create or look up API Instance in Anypoint Platform API Manager. The implementation is using Groovy script and it is wrapped as a Maven task. So it can be used by any CICD products with Maven support, in different platforms (Windows, Linux)

To deploy an API implentation, normally it will includes two deployment targets:
   1. Runtime Manager
   2. API Manager
 
### Exchange.json file in MDA

As prerequisite and assumption for this solution, the Mule Deployable Archive will need to contain a "exchange.json" file.  "exhange.json" is meta info file created by Anypoint Exchange. It is in JSON format and it contains the API spec's asset detail as stored in Exchange. 

This file is essential in binding the API Spec (RAML Files created by API Designers as maintained in Exchange) with the API implementation (Mule application implmentation as maintained by developers in SVC). 

### Command usage

The maven command will be used to create or lookup an API instance in API Manager's dedicated environment.

<code>
mvn package -P crowd  -Danypoint.user=derek.lin -Danypoint.password=(ANYPOINT PASSWORD)  -DorgId=(ORG ID) -DenvId=(ENV ID)  -DexchangeFileName=(LOCATION OF THE exchange.json file) -DtargetPropFile=(OUTPUT FILE for holding the api discovery detail)


Arguments:
  
  anypoint.user: Anypoint platform user name
  
  anypoint.password:  Anypoint platform password
   
   -- the above two arguments will be used to obtain Anypoint platform login tokens and all the platform API calls
  
  orgId:  target Anypoint platform organzaition id
  
  envId:  target Anypoint platform environment
  
  exchangeFileName: file path to the exchange.json file, this will take precedence over the exhchange.json file embedded in the Mule Deployable Archive
  
  targetPropFile: output file location as generated by the Groovy script for the API Manager's dicvoery task. This includes API name and version for Mule 3 and API id for Mule 4   

